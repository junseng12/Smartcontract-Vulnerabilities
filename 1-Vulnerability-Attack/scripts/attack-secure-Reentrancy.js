// âœ… scripts/attack-secure.js
const hre = require("hardhat");

async function main() {
  const [deployer, attacker] = await hre.ethers.getSigners();

  console.log("ðŸš€ Deployer address:", deployer.address);
  console.log("ðŸŽ¯ Attacker address:", attacker.address);

  const Secure = await hre.ethers.getContractFactory("Secure");
  const secure = await Secure.deploy();
  await secure.waitForDeployment();
  const secureAddress = await secure.getAddress();
  console.log("âœ… Secure contract deployed at:", secureAddress);

  await deployer.sendTransaction({
    to: secureAddress,
    value: hre.ethers.parseEther("5"),
  });
  console.log("ðŸ’° Secure funded with 5 ETH");

  const Attack = await hre.ethers.getContractFactory("AttackReentrancy");
  const attack = await Attack.connect(attacker).deploy(secureAddress);
  await attack.waitForDeployment();
  const attackAddress = await attack.getAddress();
  console.log("âš”ï¸  Attack contract deployed at:", attackAddress);

  try {
    const tx = await attack.connect(attacker).attack({
      value: hre.ethers.parseEther("2"),
    });
    await tx.wait();
    console.log("ðŸ”¥ Attack executed");
  } catch (error) {
    console.error("âŒ Attack failed:", error.message);
  }

  const attackerBalance = await hre.ethers.provider.getBalance(attackAddress);
  const secureBalance = await hre.ethers.provider.getBalance(secureAddress);

  console.log(
    "ðŸ“Š Attacker contract balance:",
    hre.ethers.formatEther(attackerBalance),
    "ETH"
  );
  console.log(
    "ðŸ¦ Secure contract balance:",
    hre.ethers.formatEther(secureBalance),
    "ETH"
  );
}

main().catch((error) => {
  console.error("ðŸ’¥ Fatal Error:", error);
  process.exitCode = 1;
});
